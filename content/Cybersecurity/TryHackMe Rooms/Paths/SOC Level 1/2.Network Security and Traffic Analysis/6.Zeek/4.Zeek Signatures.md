	 not#cybersecurity #soc #network 

Zeek signatures are composed of three logical paths; signature id, conditions and action. The signature breakdown is shown in the table below;

|   |   |
|---|---|
|**Signature id**|**Unique** signature name.|
|**Conditions**|**Header:** Filtering the packet headers for specific source and destination addresses, protocol and port numbers.<br><br>**<br><br>**Content:** Filtering the packet payload for specific value/pattern.<br><br>**|
|**Action**|**Default action:** Create the "signatures.log" file in case of a signature match.<br><br>**Additional action:** Trigger a Zeek script.|

|   |   |
|---|---|
|Condition Field|Available Filters|
|Header|src-ip: Source IP.<br><br>dst-ip: Destination IP.<br><br>src-port: Source port.<br><br>dst-port: Destination port.<br><br>ip-proto: Target protocol. Supported protocols; TCP, UDP, ICMP, ICMP6, IP, IP6|
|Content|**payload:** Packet payload.  <br>**http-request:** Decoded HTTP requests.  <br>**http-request-header:** Client-side HTTP headers.  <br>**http-request-body:** Client-side HTTP request bodys.  <br>**http-reply-header:** Server-side HTTP headers.  <br>**http-reply-body:** Server-side HTTP request bodys.  <br>**ftp:** Command line input of FTP sessions.|
|**Context**|**same-ip:** Filtering the source and destination addresses for duplication.|
|Action|**event:** Signature match message.|
|**Comparison  <br>Operators**|**==**, **!=**, **<**, **<=**, **>**, **>=**|
|**NOTE!**|Filters accept string, numeric and regex values.|

### Example | Cleartext Submission of Password

```
signature http-password { 
	ip-proto == tcp 
	dst-port == 80 
	payload /.*password.*/ 
	event "Cleartext Password Found!" 
} 
# signature: Signature name. 
# ip-proto: Filtering TCP connection. 
# dst-port: Filtering destination port 80. 
# payload: Filtering the "password" phrase. 
# event: Signature match message.
```

### Example | FTP Brute-force

```
signature ftp-admin { 
	ip-proto == tcp 
	ftp /.*USER.*dmin.*/ 
	event "FTP Admin Login Attempt!" 
}
```

**Let's optimise our rule and make it detect all possible FTP brute-force attempts.**

```
signature ftp-brute { 
	ip-proto == tcp 
	payload /.*530.*Login.*incorrect.*/ 
	event "FTP Brute-force Attempt" 
}
```

Zeek signature files can consist of multiple signatures. Therefore we can have one file for each protocol/situation/threat type. Let's demonstrate this feature in our global rule.

```
signature ftp-username { 
	ip-proto == tcp 
	ftp /.*USER.*/ 
	event "FTP Username Input Found!" 
} 

signature ftp-brute { 
	ip-proto == tcp 
	payload /.*530.*Login.*incorrect.*/ 
	event "FTP Brute-force Attempt!" 
}
```


### Questions

**Investigate the http.pcap file. Create the  HTTP signature shown in the task and investigate the pcap. What is the source IP of the first event?**
![[Pasted image 20240606122408.png]]

**What is the source port of the second event?**
![[Pasted image 20240606122910.png]]

**Investigate the conn.log.**  
**What is the total number of the sent and received packets from source port 38706?**
orig_pkts + resp_pkts
![[Pasted image 20240606123459.png]]


**Create the global rule shown in the task and investigate the ftp.pcap file.**  
**Investigate the notice.log. What is the number of unique events?**
`cat notice.log | zeek-cut uid | sort -r | uniq | wc -l`
1413

**What is the number of ftp-brute signature matches?**
ls


**What is the number of ftp-brute signature matches?**
`cat signatures.log | zeek-cut sig_id | grep ftp-brute | wc -l`


