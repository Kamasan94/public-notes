#cybersecurity #soc #network 

### Write Basic Scripts
```zeek
event zeek_init() 
	{
		print ("Started Zeek!"); 
	} 
event zeek_done() 
	{ 
		print ("Stopped Zeek!"); 
	} 
# zeek_init: Do actions once Zeek starts its process. 
# zeek_done: Do activities once Zeek finishes its process. 
# print: Prompt a message on the terminal.
```

Let's print the packet data to the terminal and see the raw data. In this script, we are requesting details of a connection and extracting them without any filtering or sorting of the data. To accomplish this, we are using the "new_connection" event.

```
event new_connection(c: connection) 
{ 
	print c; 
}
```


```
event new_connection(c: connection) 
{ 
	print ("###########################################################"); 
	print (""); 
	print ("New Connection Found!"); 
	print (""); 
	print fmt ("Source Host: %s # %s --->", c$id$orig_h, c$id$orig_p); 
	print fmt ("Destination Host: resp: %s # %s <---", c$id$resp_h, c$id$resp_p); 
	print (""); 
} 
# %s: Identifies string output for the source. 
# c$id: Source reference field for the identifier.
```


### Scripts 201 | Use Scripts and Signatures Together
Let's demonstrate this concept with an example. We will create a script that detects if our previously created "ftp-admin" rule has a hit.

```
event signature_match (state: signature_state, msg: string, data: string) 
{ 
	if (state$sig_id == "ftp-admin") 
	{ 
		print ("Signature hit! --> #FTP-Admin "); 
	} 
}
```

This basic script quickly checks if there is a signature hit and provides terminal output to notify us.
We used the ftp-admin signature
```
signature ftp-admin 
{ 
	ip-proto == tcp 
	ftp /.*USER.*admin.*/ 
	event "FTP Username Input Found!" 
}
```


### Scripts 202 | Load Local Scripts
#### **Load all local scripts**
You can load all local scripts identified in your "local.zeek" file.
`zeek -C -r ftp.pcap local`


### Questions
**Investigate the sample.pcap file with 103.zeek script. Investigate the terminal output. What is the number of the detected new connections?**
`zeek -C -r sample.pcap 103.zeek | grep "New Connection" | wc -l`
87

**Go to folder TASK-7/201.**  
**Investigate the ftp.pcap file with ftp-admin.sig signature and  201.zeek script. Investigate the signatures.log file. What is the number of signature hits?**
`cat signatures.log | zeek-cut uid | wc -l`
1401

**Investigate the signatures.log file. What is the total number of "administrator" username detections?**
```
cat signatures.log | zeek-cut sub_msg | grep administrator | wc -l
```


**Investigate the ftp.pcap file with all local scripts, and investigate the loaded_scripts.log file. What is the total number of loaded scripts?**
`zeek -C -r ftp.pcap 201.zeek local`
`cat loaded_scripts.log | zeek-cut name | wc -l`

**Go to folder TASK-7/202.**  
**Investigate the ftp-brute.pcap file with "**/opt/zeek/share/zeek/policy/protocols/ftp/detect-bruteforcing.zeek"** script. Investigate the notice.log file. What is the total number of brute-force detections?**
`cat notice.log | zeek-cut uid | wc -l`

